<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pomify — Focus Timer</title>
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#121212" />
  <link rel="icon" href="/icons/icon-192.png" />
  <style>
    /* Minimal clean styles (dark/light) */
    :root{--bg:#0f1720;--card:#0b1220;--accent:#f97316;--text:#e6eef8}
    [data-theme="light"]{--bg:#f4f6fb;--card:#ffffff;--accent:#0ea5a4;--text:#0b1220}
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,-apple-system}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text)}
    .wrap{max-width:420px;margin:48px auto;padding:20px}
    .card{background:var(--card);border-radius:14px;padding:20px;box-shadow:0 6px 18px rgba(2,6,23,0.5)}
    .title{display:flex;justify-content:space-between;align-items:center}
    .timer{font-size:72px;text-align:center;margin:22px 0}
    .controls{display:flex;gap:10px;justify-content:center}
    button{padding:10px 16px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-weight:600}
    .muted{opacity:.7;font-size:14px}
    .settings{display:flex;justify-content:space-between;gap:10px;margin-top:12px}
    .input-inline{display:flex;gap:6px;align-items:center}
    small{display:block;color:var(--text);opacity:.8}
    .footer{display:flex;justify-content:space-between;align-items:center;margin-top:14px}
    .cycle{font-weight:700}
    .ad-placeholder{height:60px;border-radius:8px;background:linear-gradient(90deg,rgba(255,255,255,0.03),rgba(0,0,0,0.03));display:flex;align-items:center;justify-content:center;color:var(--text);opacity:.6}
    .toggle{cursor:pointer;padding:6px;border-radius:8px}
    input[type=number]{width:72px;padding:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="title">
        <h2>Pomify</h2>
        <div>
          <button id="themeBtn" class="toggle" aria-label="toggle theme">🌙</button>
        </div>
      </div>

      <div class="timer" id="display">25:00</div>

      <div class="controls">
        <button id="startBtn">Start</button>
        <button id="pauseBtn">Pause</button>
        <button id="resetBtn">Reset</button>
      </div>

      <div class="settings">
        <div>
          <small>Work (min)</small>
          <div class="input-inline"><input id="workInput" type="number" min="1" value="25"/> <span class="muted">min</span></div>
        </div>
        <div>
          <small>Break (min)</small>
          <div class="input-inline"><input id="breakInput" type="number" min="1" value="5"/> <span class="muted">min</span></div>
        </div>
        <div>
          <small>Sound</small>
          <div class="input-inline"><input id="soundToggle" type="checkbox" checked/></div>
        </div>
      </div>

      <div class="footer">
        <div class="cycle">Cycles: <span id="cycles">0</span></div>
        <div class="muted">Offline-ready • Minimal</div>
      </div>

      <div style="margin-top:14px">
        <!-- Ad placeholder: replace with AdMob WebView integration or native Ad unit in Android wrapper -->
        <div id="adBanner" class="ad-placeholder">Ad Banner Placeholder</div>
      </div>

    </div>
  </div>

  <script>
    // Core Pomodoro logic (works offline) -------------------------------------------------
    const display = document.getElementById('display')
    const startBtn = document.getElementById('startBtn')
    const pauseBtn = document.getElementById('pauseBtn')
    const resetBtn = document.getElementById('resetBtn')
    const workInput = document.getElementById('workInput')
    const breakInput = document.getElementById('breakInput')
    const soundToggle = document.getElementById('soundToggle')
    const cyclesEl = document.getElementById('cycles')
    const themeBtn = document.getElementById('themeBtn')

    let timer = null
    let remaining = 25*60
    let running = false
    let isWork = true
    let cycles = 0

    function format(t){const m=Math.floor(t/60);const s=t%60;return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`}
    function updateDisplay(){display.textContent = format(remaining)}

    function tick(){
      if(remaining>0){remaining--; updateDisplay();}
      else{ // switch
        if(soundToggle.checked) tryPlaySound()
        if('vibrate' in navigator) navigator.vibrate([200,100,200])
        if(isWork){cycles++; cyclesEl.textContent = cycles}
        isWork = !isWork
        remaining = (isWork? parseInt(workInput.value||25)*60 : parseInt(breakInput.value||5)*60)
        updateDisplay()
      }
    }

    startBtn.addEventListener('click', ()=>{
      if(!running){timer = setInterval(tick,1000); running=true}
    })
    pauseBtn.addEventListener('click', ()=>{ if(running){clearInterval(timer);running=false} })
    resetBtn.addEventListener('click', ()=>{ clearInterval(timer); running=false; isWork=true; remaining = parseInt(workInput.value||25)*60; cycles=0; cyclesEl.textContent=cycles; updateDisplay() })

    // keep display synced when user edits durations
    workInput.addEventListener('change', ()=>{ if(isWork){ remaining = parseInt(workInput.value||25)*60; updateDisplay() }})
    breakInput.addEventListener('change', ()=>{ if(!isWork){ remaining = parseInt(breakInput.value||5)*60; updateDisplay() }})

    // sound (simple beep)
    const ctx = typeof AudioContext !== 'undefined' ? new AudioContext() : null
    function tryPlaySound(){ if(!ctx) return; const o = ctx.createOscillator(); const g = ctx.createGain(); o.connect(g); g.connect(ctx.destination); o.type='sine'; o.frequency.value=880; g.gain.value=0.05; o.start(); setTimeout(()=>{o.stop()},180) }

    // theme handling
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches
    const initialTheme = localStorage.getItem('theme') || (prefersDark? 'dark':'light')
    document.documentElement.setAttribute('data-theme', initialTheme === 'dark' ? 'dark' : 'light')
    themeBtn.addEventListener('click', ()=>{ const cur = document.documentElement.getAttribute('data-theme'); const next = cur==='dark'?'light':'dark'; document.documentElement.setAttribute('data-theme', next); localStorage.setItem('theme', next); themeBtn.textContent = next==='dark'?'🌙':'☀️' })

    // service worker registration
    if('serviceWorker' in navigator){ navigator.serviceWorker.register('/sw.js').catch(e=>console.warn('SW reg failed',e)) }

    // initial display
    remaining = parseInt(workInput.value||25)*60
    updateDisplay()

    // basic visibility handling to keep timer reasonable
    document.addEventListener('visibilitychange', ()=>{
      // when page hidden, we still run setInterval, but counting can be inaccurate in inactive tabs.
      // For production, consider using Web Worker + timestamp math.
    })

    // Ad placeholder: if wrapped as Android native app using TWA, move banner into native layout and use AdMob SDK there.
  </script>
</body>
</html>